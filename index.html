<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Premium Video Hub</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#000000;
      --panel:#1a1a1a;
      --panel-hover:#242424;
      --border:#2d2d2d;
      --primary:#ff9000;
      --primary-dark:#e68200;
      --text:#ffffff;
      --sub:#b3b3b3;
      --overlay:rgba(0,0,0,0.92);
    }
    * { box-sizing:border-box; margin:0; padding:0; }
    body{
      font-family:'Roboto',sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.6;
    }
    a{ color:var(--text); text-decoration:none; cursor:pointer; transition:color .2s; }
    a:hover{ color:var(--primary); }

    #ageGate{
      position:fixed; inset:0; z-index:9999;
      display:flex; align-items:center; justify-content:center;
      background:linear-gradient(135deg, #000 0%, #1a1a1a 100%);
      animation:fadeIn .3s;
    }
    @keyframes fadeIn{ from{opacity:0;} to{opacity:1;} }
    .gate-box{
      width:min(460px, 90%);
      padding:50px 40px;
      background:var(--panel);
      border:2px solid var(--border);
      border-radius:12px;
      text-align:center;
      box-shadow:0 20px 80px rgba(0,0,0,.8);
      animation:slideUp .4s ease-out;
    }
    @keyframes slideUp{ from{transform:translateY(30px);opacity:0;} to{transform:translateY(0);opacity:1;} }
    .gate-box h1{ 
      font-size:32px; 
      margin-bottom:16px; 
      font-weight:900;
      background:linear-gradient(90deg, var(--primary) 0%, #ffb84d 100%);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .gate-box p{ color:var(--sub); font-size:15px; margin-bottom:8px; }
    .warning-icon{ 
      font-size:60px; 
      margin-bottom:20px;
      color:var(--primary);
    }
    .gate-actions{ 
      display:flex; 
      gap:12px; 
      margin-top:32px;
      flex-wrap:wrap;
    }
    .gate-actions button{
      flex:1;
      min-width:140px;
      font-size:15px;
      font-weight:700;
      padding:15px 28px;
      border:none;
      border-radius:8px;
      cursor:pointer;
      transition:all .2s;
      text-transform:uppercase;
      letter-spacing:0.5px;
    }
    .gate-actions button:first-child{
      background:linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color:#000;
      box-shadow:0 4px 15px rgba(255,144,0,.4);
    }
    .gate-actions button:first-child:hover{
      transform:translateY(-2px);
      box-shadow:0 6px 25px rgba(255,144,0,.6);
    }
    .gate-actions button:last-child{
      background:var(--panel-hover);
      color:var(--sub);
      border:2px solid var(--border);
    }
    .gate-actions button:last-child:hover{
      border-color:var(--sub);
      color:var(--text);
    }

    header{
      position:sticky; 
      top:0; 
      z-index:100;
      background:rgba(0,0,0,0.95);
      backdrop-filter:blur(10px);
      border-bottom:1px solid var(--border);
      box-shadow:0 2px 10px rgba(0,0,0,.5);
    }
    .header-content{
      max-width:1400px;
      margin:0 auto;
      padding:14px 24px;
      display:grid;
      grid-template-columns:200px 1fr 200px;
      align-items:center;
      gap:32px;
    }
    .logo{
      font-size:28px;
      font-weight:900;
      letter-spacing:-0.5px;
      display:flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
    }
    .logo-text{ color:var(--text); }
    .logo-accent{ color:var(--primary); }
    
    .search-container{
      position:relative;
      max-width:600px;
      margin:0 auto;
      width:100%;
    }
    .search-container input{
      width:100%;
      padding:12px 20px;
      background:var(--panel);
      border:2px solid var(--border);
      border-radius:6px;
      color:var(--text);
      font-size:14px;
      transition:all .2s;
    }
    .search-container input:focus{
      outline:none;
      border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(255,144,0,.1);
    }
    
    .nav-links{
      display:flex;
      gap:24px;
      align-items:center;
      justify-content:flex-end;
    }
    .nav-links a{
      font-weight:500;
      font-size:15px;
      color:var(--sub);
      transition:color .2s;
    }
    .nav-links a:hover{ color:var(--primary); }
    .admin-icon{
      padding:10px;
      color:var(--sub);
      cursor:pointer;
      font-size:20px;
      transition:all .2s;
      border-radius:6px;
    }
    .admin-icon:hover{
      color:var(--primary);
      background:var(--panel-hover);
    }
    .admin-icon.active{
      color:var(--primary);
      background:var(--panel-hover);
    }
    .upload-btn{
      padding:10px 24px;
      background:var(--primary);
      color:#000;
      font-weight:700;
      border-radius:6px;
      font-size:14px;
      transition:all .2s;
      display:none;
    }
    .upload-btn.show{
      display:block;
    }
    .upload-btn:hover{
      background:var(--primary-dark);
      transform:translateY(-1px);
      box-shadow:0 4px 12px rgba(255,144,0,.4);
    }

    .categories{
      background:var(--panel);
      border-bottom:1px solid var(--border);
      overflow-x:auto;
      scrollbar-width:none;
    }
    .categories::-webkit-scrollbar{ display:none; }
    .category-list{
      max-width:1400px;
      margin:0 auto;
      padding:16px 24px;
      display:flex;
      gap:12px;
    }
    .cat-btn{
      padding:8px 20px;
      background:var(--panel-hover);
      border:1px solid var(--border);
      border-radius:20px;
      color:var(--sub);
      font-size:14px;
      font-weight:500;
      white-space:nowrap;
      cursor:pointer;
      transition:all .2s;
    }
    .cat-btn:hover, .cat-btn.active{
      background:var(--primary);
      color:#000;
      border-color:var(--primary);
      transform:translateY(-1px);
    }

    main{
      max-width:1400px;
      margin:0 auto;
      padding:32px 24px;
    }
    
    h2{
      font-size:24px;
      font-weight:700;
      margin-bottom:24px;
      display:flex;
      align-items:center;
      gap:12px;
    }
    h2:before{
      content:'';
      width:4px;
      height:24px;
      background:var(--primary);
      border-radius:2px;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
      gap:24px;
    }
    .card{
      background:var(--panel);
      border-radius:8px;
      overflow:hidden;
      cursor:pointer;
      transition:transform .3s ease, box-shadow .3s ease;
      position:relative;
    }
    .card:hover{
      transform:translateY(-4px) scale(1.02);
      box-shadow:0 12px 40px rgba(0,0,0,.6);
    }
    .card:hover .thumb:after{
      opacity:1;
    }
    
    .thumb{
      position:relative;
      aspect-ratio:16/9;
      background:linear-gradient(135deg, #1a1a1a 0%, #000 100%);
      overflow:hidden;
    }
    .thumb:after{
      content:'â–¶';
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:48px;
      color:var(--primary);
      background:rgba(0,0,0,.5);
      opacity:0;
      transition:opacity .3s;
    }
    .thumb video{
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .duration{
      position:absolute;
      bottom:8px;
      right:8px;
      background:rgba(0,0,0,.85);
      padding:4px 8px;
      border-radius:4px;
      font-size:12px;
      font-weight:700;
    }
    
    .info{
      padding:14px;
    }
    .info .title{
      font-weight:600;
      font-size:15px;
      margin-bottom:6px;
      line-height:1.4;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }
    .meta{
      color:var(--sub);
      font-size:13px;
      display:flex;
      gap:12px;
    }
    .meta span:before{
      content:'â€¢';
      margin:0 6px;
    }
    .meta span:first-child:before{
      display:none;
    }
    
    .delete-btn{
      position:absolute;
      top:8px;
      right:8px;
      background:rgba(0,0,0,.85);
      color:#ff4444;
      border:2px solid #ff4444;
      border-radius:6px;
      padding:6px 12px;
      font-size:12px;
      font-weight:700;
      cursor:pointer;
      opacity:0;
      transition:all .2s;
      z-index:5;
    }
    .card:hover .delete-btn{
      opacity:1;
    }
    .delete-btn:hover{
      background:#ff4444;
      color:#000;
      transform:scale(1.05);
    }
    .delete-btn-player{
      padding:10px 20px;
      background:transparent;
      color:#ff4444;
      border:2px solid #ff4444;
      border-radius:6px;
      font-size:14px;
      font-weight:700;
      cursor:pointer;
      transition:all .2s;
      margin-left:12px;
    }
    .delete-btn-player:hover{
      background:#ff4444;
      color:#000;
    }

    .player{
      background:var(--panel);
      border-radius:12px;
      overflow:hidden;
      box-shadow:0 8px 32px rgba(0,0,0,.6);
    }
    .player-video{
      width:100%;
      max-height:75vh;
      background:#000;
    }
    .player-info{
      padding:24px;
    }
    .player-info h2{
      font-size:22px;
      margin-bottom:16px;
    }
    .player-info h2:before{ display:none; }
    .player-stats{
      display:flex;
      gap:24px;
      color:var(--sub);
      font-size:14px;
      padding-bottom:20px;
      border-bottom:1px solid var(--border);
      flex-wrap:wrap;
    }
    .stat-item{
      display:flex;
      align-items:center;
      gap:8px;
    }
    .like-btn{
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 20px;
      background:var(--panel-hover);
      border:2px solid var(--border);
      border-radius:6px;
      color:var(--sub);
      font-size:14px;
      font-weight:700;
      cursor:pointer;
      transition:all .2s;
      margin-left:auto;
    }
    .like-btn:hover{
      border-color:var(--primary);
      color:var(--primary);
    }
    .like-btn.liked{
      background:var(--primary);
      border-color:var(--primary);
      color:#000;
    }
    .like-btn .icon{
      font-size:18px;
    }
    
    .related{
      margin-top:40px;
    }

    .admin-box{
      max-width:700px;
      margin:0 auto;
      background:var(--panel);
      border-radius:12px;
      padding:32px;
      box-shadow:0 8px 32px rgba(0,0,0,.4);
    }
    .admin-box h2{ margin-bottom:24px; }
    .admin-box h2:before{ display:none; }
    .form-group{
      margin-bottom:20px;
    }
    .form-group label{
      display:block;
      margin-bottom:8px;
      color:var(--sub);
      font-size:14px;
      font-weight:500;
    }
    .form-group input{
      width:100%;
      padding:14px 16px;
      background:var(--panel-hover);
      border:2px solid var(--border);
      border-radius:6px;
      color:var(--text);
      font-size:15px;
      transition:border-color .2s;
    }
    .form-group input:focus{
      outline:none;
      border-color:var(--primary);
    }
    .btn{
      width:100%;
      padding:14px;
      background:var(--primary);
      color:#000;
      border:none;
      border-radius:6px;
      font-weight:700;
      font-size:15px;
      cursor:pointer;
      transition:all .2s;
      margin-bottom:12px;
    }
    .btn:hover{
      background:var(--primary-dark);
      transform:translateY(-1px);
      box-shadow:0 4px 12px rgba(255,144,0,.4);
    }
    .btn-secondary{
      background:var(--panel-hover);
      color:var(--text);
      border:2px solid var(--border);
    }
    .btn-secondary:hover{
      background:var(--border);
      box-shadow:none;
    }
    .btn-danger{
      background:transparent;
      color:#ff4444;
      border:2px solid #ff4444;
    }
    .btn-danger:hover{
      background:#ff4444;
      color:#000;
    }
    .divider{
      margin:32px 0;
      border:none;
      border-top:1px solid var(--border);
    }
    
    .upload-area{
      border:3px dashed var(--border);
      border-radius:12px;
      padding:60px 40px;
      text-align:center;
      background:var(--panel-hover);
      transition:all .3s;
      cursor:pointer;
      margin-bottom:24px;
    }
    .upload-area.dragover{
      border-color:var(--primary);
      background:rgba(255,144,0,.1);
      transform:scale(1.02);
    }
    .upload-area.has-file{
      border-color:var(--primary);
      background:rgba(255,144,0,.05);
    }
    .upload-icon{
      font-size:64px;
      margin-bottom:16px;
      opacity:0.7;
    }
    .upload-area.dragover .upload-icon{
      animation:bounce .6s infinite;
    }
    @keyframes bounce{
      0%,100%{transform:translateY(0);}
      50%{transform:translateY(-10px);}
    }
    .upload-text{
      font-size:18px;
      font-weight:600;
      margin-bottom:8px;
      color:var(--text);
    }
    .upload-subtext{
      color:var(--sub);
      font-size:14px;
    }
    .file-preview{
      display:none;
      margin-top:20px;
      padding:20px;
      background:var(--panel);
      border-radius:8px;
      border:1px solid var(--border);
    }
    .file-preview.show{
      display:block;
    }
    .preview-video{
      max-width:300px;
      max-height:200px;
      border-radius:8px;
      margin:16px auto;
      display:block;
      background:#000;
    }
    .file-info{
      display:flex;
      flex-direction:column;
      gap:8px;
      text-align:left;
    }
    .file-info-item{
      display:flex;
      justify-content:space-between;
      padding:8px 0;
      border-bottom:1px solid var(--border);
      font-size:14px;
    }
    .file-info-item:last-child{
      border-bottom:none;
    }
    .file-info-label{
      color:var(--sub);
      font-weight:500;
    }
    .file-info-value{
      color:var(--text);
      font-weight:600;
    }
    .preview-actions{
      display:flex;
      gap:12px;
      margin-top:16px;
    }
    .preview-actions button{
      flex:1;
    }

    @media(max-width:768px){
      .header-content{ 
        grid-template-columns:1fr;
        gap:16px; 
      }
      .search-container{ 
        max-width:100%;
        order:3;
      }
      .nav-links{
        justify-content:center;
      }
      .grid{ 
        grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); 
        gap:16px; 
      }
    }
  </style>
</head>
<body>

<div id="ageGate">
  <div class="gate-box">
    <div class="warning-icon">âš ï¸</div>
    <h1>Adult Content Warning</h1>
    <p>ì´ ì›¹ì‚¬ì´íŠ¸ëŠ” ì•ˆì •ëŒ€ ì¸ì› ëŒ€ìƒ ì½˜í…ì¸ ë¥¼ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
    <p>ë§Œ 1972ì„¸ ì´ìƒë§Œ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    <div class="gate-actions">
      <button onclick="enterSite()">ì–´ì©Œë¼ê³ ìš”</button>
      <button onclick="exitSite()">ì•ˆë…•íˆê³„ì„¸ìš”</button>
    </div>
  </div>
</div>

<header>
  <div class="header-content">
    <div class="logo" onclick="go('home')">
      <span class="logo-text">Premium</span><span class="logo-accent">Hub</span>
    </div>
    <div class="search-container">
      <input type="text" placeholder="Search videos..." id="searchInput">
    </div>
    <div class="nav-links">
      <a onclick="go('home')">í™ˆ</a>
      <div class="admin-icon" id="adminIcon" onclick="toggleAdmin()" title="ì–´ë“œë¯¼ ëª¨ë“œ">âš™ï¸</div>
      <a class="upload-btn" id="uploadBtn" onclick="go('admin')">ì—…ë¡œë“œ</a>
    </div>
  </div>
</header>

<div class="categories">
  <div class="category-list">
    <div class="cat-btn active" onclick="filterCategory('all')">ì „ì²´</div>
    <div class="cat-btn" onclick="filterCategory('trending')">ì¸ê¸°</div>
    <div class="cat-btn" onclick="filterCategory('new')">ìµœì‹ </div>
    <div class="cat-btn" onclick="filterCategory('hd')">HD</div>
    <div class="cat-btn" onclick="filterCategory('featured')">ì¶”ì²œ</div>
  </div>
</div>

<main id="app"></main>

<script>
// ===== IndexedDB ì„¤ì • (ë²„ì „ ë³€ê²½ ì—†ì´ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€) =====
let db;
const DB_NAME = 'PremiumHubDB';
const DB_VERSION = 1; // ì ˆëŒ€ ë³€ê²½í•˜ì§€ ë§ˆì„¸ìš”! ë³€ê²½í•˜ë©´ ê¸°ì¡´ ë°ì´í„° ë‚ ì•„ê°‘ë‹ˆë‹¤
const STORE_NAME = 'videos';

function initDB(){
  return new Promise((resolve, reject) => {
    const request = indexedDB.open(DB_NAME, DB_VERSION);
    
    request.onerror = () => reject(request.error);
    request.onsuccess = () => {
      db = request.result;
      resolve(db);
    };
    
    request.onupgradeneeded = (e) => {
      db = e.target.result;
      if(!db.objectStoreNames.contains(STORE_NAME)){
        db.createObjectStore(STORE_NAME, {keyPath: 'id'});
      }
    };
  });
}

function saveVideoToDB(video){
  return new Promise((resolve, reject) => {
    const transaction = db.transaction([STORE_NAME], 'readwrite');
    const store = transaction.objectStore(STORE_NAME);
    const request = store.put(video);
    request.onsuccess = () => resolve();
    request.onerror = () => reject(request.error);
  });
}

function getAllVideosFromDB(){
  return new Promise((resolve, reject) => {
    const transaction = db.transaction([STORE_NAME], 'readonly');
    const store = transaction.objectStore(STORE_NAME);
    const request = store.getAll();
    request.onsuccess = () => resolve(request.result);
    request.onerror = () => reject(request.error);
  });
}

function deleteVideoFromDB(id){
  return new Promise((resolve, reject) => {
    const transaction = db.transaction([STORE_NAME], 'readwrite');
    const store = transaction.objectStore(STORE_NAME);
    const request = store.delete(id);
    request.onsuccess = () => resolve();
    request.onerror = () => reject(request.error);
  });
}

function enterSite(){ 
  localStorage.setItem('adult_ok','1'); 
  ageGate.style.display='none'; 
}
function exitSite(){ 
  location.href='https://www.google.com'; 
}
if(localStorage.getItem('adult_ok')==='1') enterSite();

let isAdmin = localStorage.getItem('admin_mode')==='1';
const ADMIN_PASSWORD = 'admin123';

function toggleAdmin(){
  if(isAdmin){
    isAdmin = false;
    localStorage.removeItem('admin_mode');
    adminIcon.classList.remove('active');
    uploadBtn.classList.remove('show');
    alert('ì–´ë“œë¯¼ ëª¨ë“œ í•´ì œë¨');
    if(document.querySelector('.player')){
      const currentVideo = videos.find(v => document.querySelector('.player-video')?.src === v.blobUrl);
      if(currentVideo) renderWatch(currentVideo.id);
    }else{
      renderHome();
    }
  }else{
    const pwd = prompt('ì–´ë“œë¯¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
    if(pwd === ADMIN_PASSWORD){
      isAdmin = true;
      localStorage.setItem('admin_mode','1');
      adminIcon.classList.add('active');
      uploadBtn.classList.add('show');
      alert('ì–´ë“œë¯¼ ëª¨ë“œ í™œì„±í™”!');
      if(document.querySelector('.player')){
        const currentVideo = videos.find(v => document.querySelector('.player-video')?.src === v.blobUrl);
        if(currentVideo) renderWatch(currentVideo.id);
      }else{
        renderHome();
      }
    }else if(pwd !== null){
      alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
    }
  }
}

function updateAdminUI(){
  if(isAdmin){
    adminIcon.classList.add('active');
    uploadBtn.classList.add('show');
  }
}

let videos = [];
let videoBlobCache = {};

async function loadVideos(){
  videos = await getAllVideosFromDB();
  
  for(let video of videos){
    if(video.fileData){
      const blob = new Blob([video.fileData], {type: video.fileType});
      videoBlobCache[video.id] = URL.createObjectURL(blob);
      video.blobUrl = videoBlobCache[video.id];
    }
    if(video.likes === undefined){
      video.likes = 0;
    }
  }
}

function getLikedVideos(){
  const liked = localStorage.getItem('liked_videos');
  return liked ? JSON.parse(liked) : [];
}

function isVideoLiked(videoId){
  const likedVideos = getLikedVideos();
  return likedVideos.includes(videoId);
}

async function toggleLike(videoId){
  const video = videos.find(v => v.id === videoId);
  if(!video) return;
  
  const likedVideos = getLikedVideos();
  const isLiked = likedVideos.includes(videoId);
  
  if(isLiked){
    video.likes = Math.max(0, video.likes - 1);
    const index = likedVideos.indexOf(videoId);
    likedVideos.splice(index, 1);
  }else{
    video.likes++;
    likedVideos.push(videoId);
  }
  
  localStorage.setItem('liked_videos', JSON.stringify(likedVideos));
  await saveVideoToDB(video);
  
  renderWatch(videoId);
}

function formatNumber(num){
  if(num>=1000000) return (num/1000000).toFixed(1)+'M';
  if(num>=1000) return (num/1000).toFixed(1)+'K';
  return num.toString();
}

function go(page,id){
  document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.cat-btn')[0].classList.add('active');
  
  if(page==='home') renderHome();
  if(page==='watch') renderWatch(id);
  if(page==='admin'){
    if(isAdmin){
      renderAdmin();
    }else{
      alert('ì–´ë“œë¯¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
      toggleAdmin();
    }
  }
}

function filterCategory(cat){
  document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  renderHome();
}

function renderHome(){
  app.innerHTML=`
    <h2>ì¶”ì²œ ë¹„ë””ì˜¤</h2>
    <div class='grid'>${videos.map(v=>`
      <div class='card' onclick="go('watch',${v.id})">
        ${isAdmin ? `<div class='delete-btn' onclick="event.stopPropagation(); deleteVideo(${v.id})">ğŸ—‘ï¸ ì‚­ì œ</div>` : ''}
        <div class='thumb'>
          <video src='${v.blobUrl}' muted preload="metadata"></video>
          <div class='duration'>${v.duration||'10:00'}</div>
        </div>
        <div class='info'>
          <div class='title'>${v.title}</div>
          <div class='meta'>
            <span>${formatNumber(v.views)} views</span>
            <span>${Math.floor(Math.random()*5)+1}ì¼ ì „</span>
          </div>
        </div>
      </div>`).join('')}
    </div>`;
}

async function renderWatch(id){
  const v=videos.find(x=>x.id===id); 
  if(!v) return;
  v.views++; 
  await saveVideoToDB(v);
  
  const others=videos.filter(x=>x.id!==id).slice(0,6);
  const isLiked = isVideoLiked(v.id);
  
  app.innerHTML=`
    <div class='player'>
      <video src='${v.blobUrl}' class='player-video' controls autoplay></video>
      <div class='player-info'>
        <h2>${v.title}</h2>
        <div class='player-stats'>
          <div class='stat-item'>
            <span>ğŸ‘ï¸</span>
            <span>${formatNumber(v.views)} views</span>
          </div>
          <div class='stat-item'>
            <span>ğŸ“…</span>
            <span>${Math.floor(Math.random()*7)+1}ì¼ ì „</span>
          </div>
          <button class='like-btn ${isLiked ? "liked" : ""}' onclick='toggleLike(${v.id})'>
            <span class='icon'>${isLiked ? "â¤ï¸" : "ğŸ¤"}</span>
            <span>${formatNumber(v.likes || 0)}</span>
          </button>
          ${isAdmin ? `<button class='delete-btn-player' onclick='deleteVideo(${v.id})'>ğŸ—‘ï¸ ì‚­ì œ</button>` : ''}
        </div>
      </div>
    </div>
    
    <div class='related'>
      <h2>ì¶”ì²œ ë¹„ë””ì˜¤</h2>
      <div class='grid'>${others.map(v2=>`
        <div class='card' onclick="go('watch',${v2.id})">
          ${isAdmin ? `<div class='delete-btn' onclick="event.stopPropagation(); deleteVideo(${v2.id})">ğŸ—‘ï¸ ì‚­ì œ</div>` : ''}
          <div class='thumb'>
            <video src='${v2.blobUrl}' muted preload="metadata"></video>
            <div class='duration'>${v2.duration||'10:00'}</div>
          </div>
          <div class='info'>
            <div class='title'>${v2.title}</div>
            <div class='meta'>
              <span>${formatNumber(v2.views)} views</span>
            </div>
          </div>
        </div>`).join('')}
      </div>
    </div>`;
}

function renderAdmin(){
  app.innerHTML=`
    <div class='admin-box'>
      <h2>ğŸ“¤ ë¹„ë””ì˜¤ ì—…ë¡œë“œ</h2>
      
      <div class='upload-area' id='uploadArea'>
        <div class='upload-icon'>ğŸ¬</div>
        <div class='upload-text'>ë¹„ë””ì˜¤ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</div>
        <div class='upload-subtext'>MP4, WebM, MOV íŒŒì¼ ì§€ì› (ìƒˆë¡œê³ ì¹¨í•´ë„ ìœ ì§€ë¨!)</div>
        <input type='file' id='fileInput' accept='video/*' style='display:none'>
      </div>
      
      <div class='file-preview' id='filePreview'>
        <video class='preview-video' id='previewVideo' controls></video>
        <div class='file-info' id='fileInfo'></div>
        <div class='preview-actions'>
          <button class='btn btn-danger' onclick='cancelFileSelection()'>ì·¨ì†Œ</button>
          <button class='btn btn-secondary' onclick='reselectFile()'>ë‹¤ì‹œ ì„ íƒ</button>
        </div>
      </div>
      
      <div class='form-group'>
        <label>ë¹„ë””ì˜¤ ì œëª©</label>
        <input id='title' placeholder='ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”'>
      </div>
      
      <button class='btn' id='publishBtn' onclick='uploadVideo()' disabled>ì—…ë¡œë“œ</button>
      
      <div class='divider'></div>
      
      <h2>âš™ï¸ ë°ì´í„° ê´€ë¦¬</h2>
      <button class='btn btn-secondary' onclick='clearAllVideos()'>ëª¨ë“  ë¹„ë””ì˜¤ ì‚­ì œ</button>
    </div>`;
  
  setupDragAndDrop();
}

let currentFile = null;
let currentDuration = '';
let currentPreviewUrl = '';

function setupDragAndDrop(){
  const uploadArea = document.getElementById('uploadArea');
  const fileInput = document.getElementById('fileInput');
  const filePreview = document.getElementById('filePreview');
  const previewVideo = document.getElementById('previewVideo');
  const publishBtn = document.getElementById('publishBtn');
  
  uploadArea.addEventListener('click', ()=> fileInput.click());
  
  uploadArea.addEventListener('dragover', (e)=>{
    e.preventDefault();
    uploadArea.classList.add('dragover');
  });
  
  uploadArea.addEventListener('dragleave', ()=>{
    uploadArea.classList.remove('dragover');
  });
  
  uploadArea.addEventListener('drop', (e)=>{
    e.preventDefault();
    uploadArea.classList.remove('dragover');
    const file = e.dataTransfer.files[0];
    if(file && file.type.startsWith('video/')){
      handleFileSelect(file);
    }else{
      alert('ë¹„ë””ì˜¤ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
    }
  });
  
  fileInput.addEventListener('change', (e)=>{
    const file = e.target.files[0];
    if(file){
      handleFileSelect(file);
    }
  });
  
  function handleFileSelect(file){
    currentFile = file;
    uploadArea.classList.add('has-file');
    filePreview.classList.add('show');
    
    if(currentPreviewUrl){
      URL.revokeObjectURL(currentPreviewUrl);
    }
    currentPreviewUrl = URL.createObjectURL(file);
    previewVideo.src = currentPreviewUrl;
    
    previewVideo.addEventListener('loadedmetadata', ()=>{
      const duration = previewVideo.duration;
      currentDuration = formatDuration(duration);
      
      const fileSize = (file.size / (1024 * 1024)).toFixed(2);
      
      document.getElementById('fileInfo').innerHTML = `
        <div class='file-info-item'>
          <span class='file-info-label'>íŒŒì¼ëª…</span>
          <span class='file-info-value'>${file.name}</span>
        </div>
        <div class='file-info-item'>
          <span class='file-info-label'>ì¬ìƒ ì‹œê°„</span>
          <span class='file-info-value'>${currentDuration}</span>
        </div>
        <div class='file-info-item'>
          <span class='file-info-label'>íŒŒì¼ í¬ê¸°</span>
          <span class='file-info-value'>${fileSize} MB</span>
        </div>
        <div class='file-info-item'>
          <span class='file-info-label'>í•´ìƒë„</span>
          <span class='file-info-value'>${previewVideo.videoWidth} x ${previewVideo.videoHeight}</span>
        </div>
      `;
      
      if(!document.getElementById('title').value){
        document.getElementById('title').value = file.name.replace(/\.[^/.]+$/, '');
      }
      
      publishBtn.disabled = false;
    }, {once: true});
  }
  
  function formatDuration(seconds){
    const h = Math.floor(seconds / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    const s = Math.floor(seconds % 60);
    
    if(h > 0){
      return `${h}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }
    return `${m}:${s.toString().padStart(2,'0')}`;
  }
}

function cancelFileSelection(){
  const uploadArea = document.getElementById('uploadArea');
  const fileInput = document.getElementById('fileInput');
  const filePreview = document.getElementById('filePreview');
  const previewVideo = document.getElementById('previewVideo');
  const publishBtn = document.getElementById('publishBtn');
  
  if(currentPreviewUrl){
    URL.revokeObjectURL(currentPreviewUrl);
  }
  
  currentFile = null;
  currentDuration = '';
  currentPreviewUrl = '';
  
  uploadArea.classList.remove('has-file');
  filePreview.classList.remove('show');
  previewVideo.src = '';
  fileInput.value = '';
  document.getElementById('title').value = '';
  publishBtn.disabled = true;
}

function reselectFile(){
  document.getElementById('fileInput').click();
}

async function uploadVideo(){
  if(!currentFile){
    alert('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return;
  }
  
  const title = document.getElementById('title').value || currentFile.name;
  
  const reader = new FileReader();
  reader.onload = async (e) => {
    const fileData = e.target.result;
    
    const video = {
      id: Date.now(),
      title: title,
      duration: currentDuration,
      views: 0,
      likes: 0,
      fileData: fileData,
      fileType: currentFile.type,
      fileName: currentFile.name
    };
    
    await saveVideoToDB(video);
    
    const blob = new Blob([fileData], {type: currentFile.type});
    const blobUrl = URL.createObjectURL(blob);
    videoBlobCache[video.id] = blobUrl;
    video.blobUrl = blobUrl;
    
    videos.push(video);
    
    cancelFileSelection();
    alert('âœ… ì—…ë¡œë“œ ì™„ë£Œ!\n\nìƒˆë¡œê³ ì¹¨í•´ë„ ë¹„ë””ì˜¤ê°€ ìœ ì§€ë©ë‹ˆë‹¤! ğŸ‰');
    go('home');
  };
  
  reader.readAsArrayBuffer(currentFile);
}

async function deleteVideo(id){
  const video = videos.find(v => v.id === id);
  if(!video) return;
  
  if(confirm(`"${video.title}"ì„(ë¥¼) ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){
    if(videoBlobCache[id]){
      URL.revokeObjectURL(videoBlobCache[id]);
      delete videoBlobCache[id];
    }
    
    await deleteVideoFromDB(id);
    
    videos = videos.filter(v => v.id !== id);
    
    if(document.querySelector('.player')){
      go('home');
    }else{
      renderHome();
    }
    
    alert('âœ… ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
  }
}

async function clearAllVideos(){
  if(!confirm('ì •ë§ë¡œ ëª¨ë“  ë¹„ë””ì˜¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')){
    return;
  }
  
  for(let id in videoBlobCache){
    URL.revokeObjectURL(videoBlobCache[id]);
  }
  videoBlobCache = {};
  
  const transaction = db.transaction([STORE_NAME], 'readwrite');
  const store = transaction.objectStore(STORE_NAME);
  await store.clear();
  
  videos = [];
  alert('âœ… ëª¨ë“  ë¹„ë””ì˜¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
  go('home');
}

searchInput.addEventListener('input', (e)=>{
  const query=e.target.value.toLowerCase();
  if(query){
    const filtered=videos.filter(v=>v.title.toLowerCase().includes(query));
    app.innerHTML=`
      <h2>ê²€ìƒ‰ ê²°ê³¼: "${query}"</h2>
      <div class='grid'>${filtered.map(v=>`
        <div class='card' onclick="go('watch',${v.id})">
          ${isAdmin ? `<div class='delete-btn' onclick="event.stopPropagation(); deleteVideo(${v.id})">ğŸ—‘ï¸ ì‚­ì œ</div>` : ''}
          <div class='thumb'>
            <video src='${v.blobUrl}' muted preload="metadata"></video>
            <div class='duration'>${v.duration||'10:00'}</div>
          </div>
          <div class='info'>
            <div class='title'>${v.title}</div>
            <div class='meta'>
              <span>${formatNumber(v.views)} views</span>
            </div>
          </div>
        </div>`).join('')}
      </div>`;
  }else{
    renderHome();
  }
});

async function init(){
  await initDB();
  await loadVideos();
  updateAdminUI();
  go('home');
}

init();
</script>
</body>
</html>
